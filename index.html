<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>デカブサ漢字クロス（キャラ紹介テスト）</title>

<style>
  :root{
    --bg:#f2f2f2;
    --panel:#ffffff;
    --text:#111;
    --muted:#666;
    --line:#d8d8d8;
    --btn:#ddd;
    --btnActive:#999;
  }

  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    text-align:center;
  }

  /* 画面全体：スクロールさせない */
  .screen{
    max-width:420px;
    margin:0 auto;
    height:100svh;
    padding:16px;
    box-sizing:border-box;
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  /* ヘッダー */
  .topbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }
  .title{
    font-size:14px;
    color:var(--muted);
    text-align:left;
  }
  .smallbtn{
    border:none;
    background:var(--btn);
    padding:10px 12px;
    border-radius:10px;
    font-size:12px;
  }

  /* キャラ表示枠（全身が必ず入る） */
  .character{
    height:160px;
    border-radius:14px;
    background:var(--panel);
    border:1px solid var(--line);
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
    user-select:none;
  }
  .character img{
    width:100%;
    height:100%;
    object-fit:contain;
    display:block;
  }

  /* メッセージ（占いと同格枠） */
  .message{
    font-size:18px;
    min-height:1.6em;
    user-select:none;
  }

  /* 問題表示（ダミー） */
  .crossWrap{
    background:var(--panel);
    border:1px solid var(--line);
    border-radius:14px;
    padding:12px;
    flex:1; /* 余白を吸う */
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .cross{
    font-size:20px;
    line-height:1.8;
  }

  /* 下部キャラ切替バー */
  .character-bar{
    display:flex;
    gap:8px;
  }
  .character-bar button{
    flex:1;
    padding:10px 0;
    font-size:12px;
    border:none;
    border-radius:10px;
    background:var(--btn);
  }
  .character-bar button.active{
    background:var(--btnActive);
    color:#fff;
  }

  /* ===== キャラ紹介オーバーレイ ===== */
  .overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.35);
    display:none;
    align-items:center;
    justify-content:center;
    padding:16px;
    box-sizing:border-box;
  }
  .overlay.show{ display:flex; }

  .sheet{
    width:min(420px, 100%);
    background:var(--panel);
    border-radius:16px;
    border:1px solid var(--line);
    overflow:hidden;
  }

  .sheetHeader{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 12px;
    border-bottom:1px solid var(--line);
  }
  .sheetHeader .h{
    font-size:13px;
    color:var(--muted);
  }
  .closeBtn{
    border:none;
    background:var(--btn);
    padding:10px 12px;
    border-radius:10px;
    font-size:12px;
  }

  .profileArea{
    padding:14px 14px 10px;
  }

  .profileCard{
    border:1px solid var(--line);
    border-radius:14px;
    padding:12px;
  }

  .profileTop{
    display:flex;
    gap:12px;
    align-items:center;
  }

  .avatar{
    width:88px;
    height:88px;
    border-radius:14px;
    background:var(--panel);
    border:1px solid var(--line);
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    user-select:none;
  }
  .avatar img{
    width:100%;
    height:100%;
    object-fit:contain;
    display:block;
  }

  .profileText{
    text-align:left;
    flex:1;
  }
  .name{
    font-size:16px;
    font-weight:800;
    margin-bottom:4px;
  }
  .ability{
    font-size:13px;
    color:var(--muted);
    margin-bottom:8px;
  }
  .desc{
    font-size:13px;
    line-height:1.5;
    color:#222;
  }
  .quote{
    margin-top:10px;
    padding-top:10px;
    border-top:1px dashed var(--line);
    font-size:13px;
    color:#222;
  }

  .navRow{
    display:flex;
    gap:8px;
    padding:10px 14px 14px;
  }
  .navRow button{
    flex:1;
    border:none;
    background:var(--btn);
    padding:12px 0;
    border-radius:12px;
    font-size:12px;
  }

  .pager{
    padding:0 14px 14px;
    font-size:12px;
    color:var(--muted);
    user-select:none;
  }

  .hintRow{
    padding:0 14px 14px;
    font-size:12px;
    color:var(--muted);
    user-select:none;
  }

  /* 「課金してもこの程度」を明示（やることは変わらない） */
  .note{
    padding:12px 14px 14px;
    border-top:1px solid var(--line);
    font-size:12px;
    color:var(--muted);
    line-height:1.5;
    text-align:left;
  }
</style>
</head>

<body>
<div class="screen">

  <div class="topbar">
    <div class="title">
      デカブサ漢字クロス（総合・開発用）
    </div>
    <button class="smallbtn" id="openIntroBtn">キャラ紹介</button>
  </div>

  <!-- ここに画像が入る -->
  <div id="character" class="character"></div>

  <div id="message" class="message">一字、入力して</div>

  <div class="crossWrap">
    <div class="cross">
      安<br>
      ↓<br>
      □<br>
      ↓<br>
      中<br><br>
      決 → □ → 配
    </div>
  </div>

  <div class="character-bar" id="charBar"></div>

</div>

<!-- キャラ紹介オーバーレイ -->
<div class="overlay" id="introOverlay" aria-hidden="true">
  <div class="sheet" role="dialog" aria-modal="true">
    <div class="sheetHeader">
      <div class="h">キャラ紹介（雰囲気だけ変わります）</div>
      <button class="closeBtn" id="closeIntroBtn">閉じる</button>
    </div>

    <div class="profileArea">
      <div class="profileCard" id="profileCard">
        <div class="profileTop">
          <div class="avatar" id="introAvatar"></div>
          <div class="profileText">
            <div class="name" id="introName">デカブサ</div>
            <div class="ability" id="introAbility">能力：特になし</div>
            <div class="desc" id="introDesc">何も教えない。褒めない。怒らない。</div>
          </div>
        </div>
        <div class="quote" id="introQuote">代表： 「……」</div>
      </div>
    </div>

    <div class="navRow">
      <button id="prevBtn">←</button>
      <button id="useBtn">このキャラにする</button>
      <button id="nextBtn">→</button>
    </div>

    <div class="pager" id="pager">1 / 5</div>
    <div class="hintRow">左右にスワイプでも切り替え可</div>

    <div class="note">
      追加キャラは、<b>表示</b>と<b>文言</b>が変わるだけです。<br>
      やること（漢字を1字入れて判定）は変わりません。
    </div>
  </div>
</div>

<script>
  // 5キャラ（デカブサ＋4人）
  const characters = [
    {
      id: "dekabusa",
      name: "デカブサ",
      short: "デ",
      image: "img/dekabusa.png",
      ability: "能力：特になし",
      desc: "何も教えない。褒めない。怒らない。",
      quote: "代表： 「……」",
      message: "一字、入力して"
    },
    {
      id: "gori",
      name: "ゴリさん",
      short: "ゴ",
      image: "img/gori.png",
      ability: "能力：タイムリープ",
      desc: "未来が分かる。けど言わない。変えない。",
      quote: "代表： 「……この未来だった」",
      message: "……この未来だった"
    },
    {
      id: "tora",
      name: "トラさん",
      short: "ト",
      image: "img/tora.png",
      ability: "能力：分身",
      desc: "分身できる。だからって何もしない。",
      quote: "代表： 「……」",
      message: "静かに考えて"
    },
    {
      id: "king",
      name: "キング",
      short: "王",
      image: "img/king.png",
      ability: "能力：時を止める",
      desc: "時を止める。褒めるときは止めて拍手3回。",
      quote: "代表： 「（止めて拍手）」",
      message: "王は見ている"
    },
    {
      id: "ani",
      name: "デカブサ兄",
      short: "兄",
      image: "img/ani.png",
      ability: "能力：加速装置",
      desc: "速い。けど反応は薄い。空気だけ重い。",
      quote: "代表： （なし）",
      message: "……"
    }
  ];

  // 現在選択キャラ
  let selectedIndex = 0;

  // 紹介画面の現在ページ
  let introIndex = 0;

  const charBar = document.getElementById("charBar");

  function safeImgHTML(src, alt){
    // 画像が読めない時に文字に戻す用（onerror）
    const escAlt = (alt || "").replace(/"/g, "&quot;");
    const escSrc = (src || "").replace(/"/g, "&quot;");
    return `<img src="${escSrc}" alt="${escAlt}" onerror="this.replaceWith(document.createTextNode('${escAlt}'))">`;
  }

  // 下部キャラバー生成
  function buildCharBar(){
    charBar.innerHTML = "";
    characters.forEach((c, i) => {
      const btn = document.createElement("button");
      btn.textContent = c.name;
      btn.onclick = () => selectChar(i);
      if(i === selectedIndex) btn.classList.add("active");
      charBar.appendChild(btn);
    });
  }

  // メイン画面反映
  function selectChar(i){
    selectedIndex = i;
    const c = characters[i];

    const charBox = document.getElementById("character");
    charBox.innerHTML = c.image ? safeImgHTML(c.image, c.name) : c.name;

    document.getElementById("message").textContent = c.message;

    // active更新
    Array.from(charBar.querySelectorAll("button")).forEach((b, idx) => {
      b.classList.toggle("active", idx === selectedIndex);
    });
  }

  // ===== キャラ紹介オーバーレイ =====
  const overlay = document.getElementById("introOverlay");

  function openIntro(){
    introIndex = selectedIndex; // 開いた時は現在キャラに合わせる
    renderIntro();
    overlay.classList.add("show");
    overlay.setAttribute("aria-hidden","false");
  }

  function closeIntro(){
    overlay.classList.remove("show");
    overlay.setAttribute("aria-hidden","true");
  }

  function renderIntro(){
    const c = characters[introIndex];

    const avatar = document.getElementById("introAvatar");
    avatar.innerHTML = c.image ? safeImgHTML(c.image, c.name) : c.short;

    document.getElementById("introName").textContent = c.name;
    document.getElementById("introAbility").textContent = c.ability;
    document.getElementById("introDesc").textContent = c.desc;
    document.getElementById("introQuote").textContent = c.quote;
    document.getElementById("pager").textContent = `${introIndex + 1} / ${characters.length}`;
  }

  function introPrev(){
    introIndex = (introIndex - 1 + characters.length) % characters.length;
    renderIntro();
  }
  function introNext(){
    introIndex = (introIndex + 1) % characters.length;
    renderIntro();
  }
  function useThisChar(){
    selectChar(introIndex);
    closeIntro();
  }

  // ボタン紐付け
  document.getElementById("openIntroBtn").addEventListener("click", openIntro);
  document.getElementById("closeIntroBtn").addEventListener("click", closeIntro);
  document.getElementById("prevBtn").addEventListener("click", introPrev);
  document.getElementById("nextBtn").addEventListener("click", introNext);
  document.getElementById("useBtn").addEventListener("click", useThisChar);

  // 背景タップで閉じる
  overlay.addEventListener("click", (e) => {
    if(e.target === overlay) closeIntro();
  });

  // スワイプ対応（紹介カード上で左右スワイプ）
  let sx = 0, sy = 0, tracking = false;
  const card = document.getElementById("profileCard");

  card.addEventListener("touchstart", (e) => {
    const t = e.touches[0];
    sx = t.clientX; sy = t.clientY;
    tracking = true;
  }, {passive:true});

  card.addEventListener("touchend", (e) => {
    if(!tracking) return;
    tracking = false;
    const t = e.changedTouches[0];
    const dx = t.clientX - sx;
    const dy = t.clientY - sy;

    if(Math.abs(dx) > 45 && Math.abs(dy) < 35){
      if(dx > 0) introPrev();
      else introNext();
    }
  }, {passive:true});

  // 初期化
  buildCharBar();
  selectChar(0);
</script>
</body>
</html>
